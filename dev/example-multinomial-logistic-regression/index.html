<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Multinomial logistic regression ¬∑ SossMLJ.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">SossMLJ.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../example-linear-regression/">Linear regression</a></li><li class="is-active"><a class="tocitem" href>Multinomial logistic regression</a></li></ul></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Multinomial logistic regression</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Multinomial logistic regression</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/cscherrer/SossMLJ.jl/blob/master/examples/example-multinomial-logistic-regression.jl" title="Edit on GitHub"><span class="docs-icon fab">ÔÇõ</span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Multinomial-logistic-regression"><a class="docs-heading-anchor" href="#Multinomial-logistic-regression">Multinomial logistic regression</a><a id="Multinomial-logistic-regression-1"></a><a class="docs-heading-anchor-permalink" href="#Multinomial-logistic-regression" title="Permalink"></a></h1><p>Import the necessary packages:</p><pre><code class="language-julia">using DataFrames
using Distributions
using MLJBase
using NNlib
using RDatasets
using Soss
using SossMLJ
using Statistics</code></pre><p>In this example, we fit a Bayesian multinomial logistic regression model with the canonical link function.</p><p>Suppose that we are given a matrix of features <code>X</code> and a column vector of labels <code>y</code>. <code>X</code> has <code>n</code> rows and <code>p</code> columns. <code>y</code> has <code>n</code> elements. We assume that our observation vector <code>y</code> is a realization of a random variable <code>Y</code>. We define <code>Œº</code> (mu) as the expected value of <code>Y</code>, i.e. <code>Œº := E[Y]</code>. Our model comprises three components:</p><ol><li>The probability distribution of <code>Y</code>. We assume that each <code>Y·µ¢</code> follows a</li></ol><p>multinomial distribution with <code>k</code> categories, mean <code>Œº·µ¢</code>, and one trial. A multinomial distribution with one trial is equivalent to the categorical distribution. Therefore, these two statements are equivalent:</p><ul><li><code>Y·µ¢</code> follows a multinomial distribution with <code>k</code> categories, mean <code>Œº·µ¢</code>, and one trial.</li><li><code>Y·µ¢</code> follows a categorical distribution with <code>k</code> categories and mean <code>Œº·µ¢</code>.</li></ul><p>In the special case of two categories, i.e. <code>k = 2</code>, the multinomial distribution reduces to the binomial distribution, the categorical distribution reduces to the Bernoulli distribution, and the  multinomial logistic regression model reduces to the logistic regression model.</p><ol><li>The systematic component, which consists of linear predictor <code>Œ∑</code> (eta),</li></ol><p>which we define as <code>Œ∑ := XŒ≤</code>, where <code>Œ≤</code> is the column vector of <code>p</code> coefficients.</p><ol><li>The link function <code>g</code>, which provides the following relationship:</li></ol><p><code>g(E[Y]) = g(Œº) = Œ∑ = XŒ≤</code>. It follows that <code>Œº = g‚Åª¬π(Œ∑)</code>, where <code>g‚Åª¬π</code> denotes the inverse of <code>g</code>. Recall that in logistic regression, the canonical link function was the logit function, and the inverse of the logit function was the sigmoidal logistic function. In multinomial logistic regression, the canonical link function is the generalized logit function (which is a generalization of the logit function). The inverse of the generalized logit function is the softmax function (which is a generalization of the sigmoidal logistic function). Therefore, when using the canonical link function, <code>Œº = g‚Åª¬π(Œ∑) = softmax(Œ∑)</code>.</p><p>In this model, the parameters that we want to estimate are the coefficients <code>Œ≤</code>. We need to select prior distributions for these parameters. For each <code>Œ≤·µ¢</code> we choose a normal distribution with zero mean and unit variance<code>. Here,</code>Œ≤·µ¢<code>denotes the</code>i<code>th component of</code>Œ≤`.</p><p>We define this model using the Soss probabilistic programming library:</p><pre><code class="language-julia">m = @model X,pool begin
    n = size(X,1) # number of observations
    p = size(X,2) # number of features
    k = length(pool.levels) # number of classes
    Œ≤ ~ Normal(0.0, 1.0) |&gt; iid(p, k) # coefficients
    Œ∑ = X * Œ≤ # linear predictor
    Œº = NNlib.softmax(Œ∑; dims=2) # Œº = g‚Åª¬π(Œ∑) = softmax(Œ∑)
    y_dists = UnivariateFinite(pool.levels, Œº; pool=pool) # `UnivariateFinite` is mathematically equivalent to `Categorical`
    y ~ For(j -&gt; y_dists[j], n) # `Y·µ¢ ~ UnivariateFinite(mean=Œº·µ¢, categories=k)`, which is mathematically equivalent to `Y·µ¢ ~ Categorical(mean=Œº·µ¢, categories=k)`
end;</code></pre><p>Import the <em>Iris</em> flower data set:</p><pre><code class="language-julia">iris = dataset(&quot;datasets&quot;, &quot;iris&quot;);</code></pre><p>Define our feature columns:</p><pre><code class="language-julia">feature_columns = [
    :PetalLength,
    :PetalWidth,
    :SepalLength,
    :SepalWidth,
]</code></pre><pre class="documenter-example-output">4-element Array{Symbol,1}:
 :PetalLength
 :PetalWidth
 :SepalLength
 :SepalWidth</pre><p>Define our label column:</p><pre><code class="language-julia">label_column = :Species</code></pre><pre class="documenter-example-output">:Species</pre><p>Convert the Soss model into a <code>SossMLJModel</code>:</p><pre><code class="language-julia">model = SossMLJModel(m;
    hyperparams = (pool=iris.Species.pool,),
    transform   = tbl -&gt; (X=MLJBase.matrix(tbl[!, feature_columns]),),
    infer       = dynamicHMC,
    response    = :y,
);</code></pre><p>Create an MLJ machine for fitting our model:</p><pre><code class="language-julia">mach = MLJBase.machine(model, iris[!, feature_columns], iris[!, :Species])</code></pre><pre class="documenter-example-output">[34mMachine{SossMLJModel{Model{,‚Ä¶},‚Ä¶}} @877[39m trained 0 times.
  args: 
    1:	[34mSource @284[39m ‚èé `ScientificTypes.Table{AbstractArray{ScientificTypes.Continuous,1}}`
    2:	[34mSource @846[39m ‚èé `AbstractArray{ScientificTypes.Multiclass{3},1}`
</pre><p>Fit the machine. This may take several minutes.</p><pre><code class="language-julia">MLJBase.fit!(mach)</code></pre><pre class="documenter-example-output">[34mMachine{SossMLJModel{Model{,‚Ä¶},‚Ä¶}} @877[39m trained 1 time.
  args: 
    1:	[34mSource @284[39m ‚èé `ScientificTypes.Table{AbstractArray{ScientificTypes.Continuous,1}}`
    2:	[34mSource @846[39m ‚èé `AbstractArray{ScientificTypes.Multiclass{3},1}`
</pre><p>Construct the posterior:</p><pre><code class="language-julia">predictor_joint = MLJBase.predict_joint(mach, iris[!, feature_columns])
typeof(predictor_joint)</code></pre><pre class="documenter-example-output">SossMLJ.SossMLJPredictor{SossMLJModel{Soss.Model{NamedTuple{(:X, :pool),T} where T&lt;:Tuple,TypeEncoding(begin
    k = length(pool.levels)
    p = size(X, 2)
    Œ≤ ~ Normal(0.0, 1.0) |&gt; iid(p, k)
    Œ∑ = X * Œ≤
    Œº = NNlib.softmax(Œ∑; dims = 2)
    y_dists = UnivariateFinite(pool.levels, Œº; pool = pool)
    n = size(X, 1)
    y ~ For((j-&gt;begin
                    y_dists[j]
                end), n)
end),TypeEncoding(Main.ex-example-multinomial-logistic-regression)},Main.ex-example-multinomial-logistic-regression.var&quot;#1#2&quot;,typeof(Soss.dynamicHMC),NamedTuple{(:pool,),Tuple{CategoricalArrays.CategoricalPool{String,UInt8,CategoricalArrays.CategoricalValue{String,UInt8}}}},Symbol},Array{NamedTuple{(:Œ≤,),Tuple{Array{Float64,2}}},1},Soss.Model{NamedTuple{(:X, :pool, :Œ≤),T} where T&lt;:Tuple,TypeEncoding(begin
    Œ∑ = X * Œ≤
    Œº = NNlib.softmax(Œ∑; dims = 2)
    y_dists = UnivariateFinite(pool.levels, Œº; pool = pool)
    n = size(X, 1)
    y ~ For((j-&gt;begin
                    y_dists[j]
                end), n)
end),TypeEncoding(Main.ex-example-multinomial-logistic-regression)},NamedTuple{(:X, :pool),Tuple{Array{Float64,2},CategoricalArrays.CategoricalPool{String,UInt8,CategoricalArrays.CategoricalValue{String,UInt8}}}}}</pre><p>Draw a sample from the posterior:</p><pre><code class="language-julia">single_sample = rand(predictor_joint)</code></pre><pre class="documenter-example-output">150-element Array{CategoricalArrays.CategoricalValue{String,UInt8},1}:
 &quot;setosa&quot;
 &quot;setosa&quot;
 &quot;setosa&quot;
 &quot;setosa&quot;
 &quot;setosa&quot;
 &quot;setosa&quot;
 &quot;setosa&quot;
 &quot;setosa&quot;
 &quot;setosa&quot;
 &quot;versicolor&quot;
 ‚ãÆ
 &quot;versicolor&quot;
 &quot;versicolor&quot;
 &quot;virginica&quot;
 &quot;virginica&quot;
 &quot;virginica&quot;
 &quot;virginica&quot;
 &quot;virginica&quot;
 &quot;virginica&quot;
 &quot;virginica&quot;</pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../example-linear-regression/">¬´ Linear regression</a><a class="docs-footer-nextpage" href="../api/">API ¬ª</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Friday 28 August 2020 01:03">Friday 28 August 2020</span>. Using Julia version 1.5.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
